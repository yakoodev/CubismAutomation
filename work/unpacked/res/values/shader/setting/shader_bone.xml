<?xml version="1.0" encoding="UTF-8"?>
<shader language="GLSL">
    <properties>
        <property name="s_texture0" text="Texture" default="red" />
    </properties>
    <blend srcColor="ONE" dstColor="ONE_MINUS_SRC_ALPHA" srcAlpha="ONE" dstAlpha="ONE_MINUS_SRC_ALPHA" />
    <cull mode="BACK" />
    <!--#############################  VERTEX  #############################-->
    <vertex><![CDATA[
#version 150

#if __VERSION__ >= 130
  #define attribute in
  #define varying out
#endif

#ifdef GL_ES
precision mediump float;
precision mediump int;
#endif

uniform mat4 worldToCameraMatrix , projectionMatrix ;
uniform mat4 localToWorldMatrix ;// TEST IMPL

attribute vec4 positions;
attribute vec4 normals;
uniform vec4 u_lightColor;
uniform vec4 u_lightPosition ;

varying vec3	lightIntensity ;
varying vec4	v_color ;

void main(void)
{
 	gl_Position = projectionMatrix * worldToCameraMatrix * localToWorldMatrix * positions ;
	vec3 u_ambientLight = vec3(0.15) ;
//    vec4 norm = normalize(normals) ;
    vec4 vertexPosition = localToWorldMatrix * positions ;

    vec4 norm = normalize( normals ) ;

    vec3 lightDirection = normalize( vec3( u_lightPosition ) - vec3( vertexPosition ) ) ;

    float nDotL = max( dot ( lightDirection , vec3(norm) ) , 0.0 ) ;
    vec3 diffuse = vec3(u_lightColor) * nDotL ;
    vec3 ambient = u_ambientLight ;
    v_color = vec4( 0.2 * u_lightColor +  0.6*diffuse + 0.2*ambient , 1.0 ) ;
}

]]></vertex>
    <!--############################  FRAGMENT  ############################-->
    <fragment><![CDATA[

#version 150
//#extension GL_EXT_gpu_shader4 : enable

#if __VERSION__ >= 130
  #define varying in
  out vec4 mgl_FragColor;
  #define gl_FragColor mgl_FragColor
#endif

#ifdef GL_ES
precision mediump float;
precision mediump int;
#endif

varying vec3	lightIntensity ;
varying vec4	v_color ;


void main (void)
{
	gl_FragColor = v_color ;//vec4(lightIntensity,1.0) ;
}

]]></fragment>
</shader>

